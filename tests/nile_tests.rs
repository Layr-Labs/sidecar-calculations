use sqlite_functions::*;

#[cfg(test)]
mod nile_tests {
    use super::*;

    #[test]
    fn test_nile_staker_token_rewards() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_STAKER_TOKENS).unwrap();

        let mut errors = 0;
        for result in results {
            let staker_proportion = &result[0];
            let tokens_per_day = &result[1];
            let tokens = nile_calculations::nile_staker_token_rewards(&staker_proportion, &tokens_per_day);
            let expected = &result[2];
            if tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    #[test]
    fn test_nile_operator_token_rewards() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_OPERATOR_TOKENS).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_tokens = nile_calculations::nile_operator_token_rewards(&result[0]);
            let expected = &result[1];
            if total_staker_operator_tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", total_staker_operator_tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    #[test]
    fn test_nile_staker_total() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_STAKER_TOTALS).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_payout = &result[0];
            let operator_tokens = &result[1];
            let expected_result = &result[2];

            let staker_tokens = math::subtract_big(total_staker_operator_payout, operator_tokens);
            if staker_tokens != "" && staker_tokens != *expected_result {
                println!("Actual:   {}\nExpected: {}\n", staker_tokens, expected_result);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    const JSON_RESULTS_STAKER_TOKENS: &str = r#"
    [
        ["0.000000240375027", "71428571428571350000000", "17169644785714300"],
        ["0.000000182660779", "71428571428571350000000", "13047198500000000"],
        ["0.000000182637329", "71428571428571350000000", "13045523500000000"],
        ["0.000003470116004", "71428571428571350000000", "247865428857143000"],
        ["0.000021918909001", "71428571428571350000000", "1565636357214280000"],
        ["0.000003653540054", "71428571428571350000000", "260967146714285000"],
        ["0.000000913478881", "71428571428571350000000", "65248491499999900"],
        ["0.000000013027298", "71428571428571350000000", "930521285714285"],
        ["0.000002554296328", "71428571428571350000000", "182449737714286000"],
        ["0.000001826748407", "71428571428571350000000", "130482029071428000"],
        ["0.000001826999023", "71428571428571350000000", "130499930214286000"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000002366274776", "71428571428571350000000", "169019626857143000"],
        ["0.00000164380537", "71428571428571350000000", "117414669285714000"],
        ["0.000000370168897", "71428571428571350000000", "26440635500000000"],
        ["0.000000182691271", "71428571428571350000000", "13049376500000000"],
        ["0.000000365323009", "71428571428571350000000", "26094500642857100"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000182702737", "71428571428571350000000", "13050195500000000"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000018269785", "71428571428571350000000", "1304984642857140"],
        ["0.000000182681938", "71428571428571350000000", "13048709857142800"],
        ["0.000001987375845", "71428571428571350000000", "141955417500000000"],
        ["0.000000042012909", "71428571428571350000000", "3000922071428570"],
        ["0.000000730597415", "71428571428571350000000", "52185529642857100"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000039457125", "71428571428571350000000", "2818366071428570"],
        ["0.000000365369184", "71428571428571350000000", "26097798857142800"],
        ["0.000000182677726", "71428571428571350000000", "13048409000000000"],
        ["0.000000310572503", "71428571428571350000000", "22183750214285700"],
        ["0.000004226908614", "71428571428571350000000", "301922043857143000"],
        ["0.000000365417168", "71428571428571350000000", "26101226285714300"],
        ["0.000000177185592", "71428571428571350000000", "12656113714285700"],
        ["0.000001643917568", "71428571428571350000000", "117422683428571000"],
        ["0.00000018267416", "71428571428571350000000", "13048154285714300"],
        ["0.000002740461681", "71428571428571350000000", "195747262928571000"],
        ["0.000000002557447", "71428571428571350000000", "182674785714286"],
        ["0.000001826557", "71428571428571350000000", "130468357142857000"],
        ["0.000000164389211", "71428571428571350000000", "11742086500000000"],
        ["0.000002739983387", "71428571428571350000000", "195713099071428000"],
        ["0.000000036533111", "71428571428571350000000", "2609507928571430"],
        ["0.000000182671879", "71428571428571350000000", "13047991357142800"],
        ["0.000000091309387", "71428571428571350000000", "6522099071428560"],
        ["0.000000182670306", "71428571428571350000000", "13047879000000000"],
        ["0.000007305801647", "71428571428571350000000", "521842974785714000"],
        ["0.000000182690094", "71428571428571350000000", "13049292428571400"],
        ["0.000004749759756", "71428571428571350000000", "339268554000000000"],
        ["0.000000190360649", "71428571428571350000000", "13597189214285700"],
        ["0.000000182672242", "71428571428571350000000", "13048017285714300"],
        ["0.000000365328113", "71428571428571350000000", "26094865214285700"],
        ["0.000002739922568", "71428571428571350000000", "195708754857143000"],
        ["0.000000182660056", "71428571428571350000000", "13047146857142800"],
        ["0.00000006211612", "71428571428571350000000", "4436865714285710"],
        ["0.000000049568549", "71428571428571350000000", "3540610642857140"],
        ["0.000000913489267", "71428571428571350000000", "65249233357142800"],
        ["0.000000182580477", "71428571428571350000000", "13041462642857100"],
        ["0.000001643953541", "71428571428571350000000", "117425252928571000"],
        ["0.000000182670651", "71428571428571350000000", "13047903642857100"],
        ["0.000000018269744", "71428571428571350000000", "1304981714285710"],
        ["0.000000367521622", "71428571428571350000000", "26251544428571400"],
        ["0.000000007306545", "71428571428571350000000", "521896071428571"],
        ["0.000000182670306", "71428571428571350000000", "13047879000000000"],
        ["0.000000018269828", "71428571428571350000000", "1304987714285710"],
        ["0.000000164413436", "71428571428571350000000", "11743816857142800"],
        ["0.000000027764809", "71428571428571350000000", "1983200642857140"],
        ["0.000000401954789", "71428571428571350000000", "28711056357142800"],
        ["0.000000124233734", "71428571428571350000000", "8873838142857130"],
        ["0.000000482267287", "71428571428571350000000", "34447663357142800"],
        ["0.000000730719481", "71428571428571350000000", "52194248642857100"],
        ["0.000000182688572", "71428571428571350000000", "13049183714285700"],
        ["0.000000913289559", "71428571428571350000000", "65234968499999900"],
        ["0.000001826644113", "71428571428571350000000", "130474579500000000"],
        ["0.000000182671879", "71428571428571350000000", "13047991357142800"],
        ["0.000000182662499", "71428571428571350000000", "13047321357142800"],
        ["0.000000365352705", "71428571428571350000000", "26096621785714300"],
        ["0.000000182705292", "71428571428571350000000", "13050378000000000"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000363500629", "71428571428571350000000", "25964330642857100"],
        ["0.000000182664822", "71428571428571350000000", "13047487285714300"],
        ["0.000001004711624", "71428571428571350000000", "71765115999999900"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000000091335153", "71428571428571350000000", "6523939499999990"],
        ["0.000000200927655", "71428571428571350000000", "14351975357142800"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000182698286", "71428571428571350000000", "13049877571428600"],
        ["0.000001826621546", "71428571428571350000000", "130472967571428000"],
        ["0.000001644257716", "71428571428571350000000", "117446979714286000"],
        ["0.000000730781207", "71428571428571350000000", "52198657642857100"],
        ["0.000002369608877", "71428571428571350000000", "169257776928571000"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000005845092031", "71428571428571350000000", "417506573642857000"],
        ["0.000000365351989", "71428571428571350000000", "26096570642857100"],
        ["0.000001826900944", "71428571428571350000000", "130492924571428000"],
        ["0.000000182684202", "71428571428571350000000", "13048871571428600"],
        ["0.00000018267987", "71428571428571350000000", "13048562142857100"],
        ["0.000000009133515", "71428571428571350000000", "652393928571428"],
        ["0.000000182698286", "71428571428571350000000", "13049877571428600"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.00000054801092", "71428571428571350000000", "39143637142857100"]
    ]"#;

    const JSON_RESULTS_OPERATOR_TOKENS: &str = r#"
    [
        ["13047198500000000", "1304719850000000"],
        ["13045523500000000", "1304552350000000"],
        ["247865428857143000", "24786542885714300"],
        ["1565636357214280000", "156563635721428000"],
        ["260967146714285000", "26096714671428500"],
        ["65248491499999900", "6524849149999990"],
        ["930521285714285", "93052128571429"],
        ["182449737714286000", "18244973771428600"],
        ["130482029071428000", "13048202907142800"],
        ["130499930214286000", "13049993021428600"],
        ["13048257857142800", "1304825785714280"],
        ["13048983500000000", "1304898350000000"],
        ["169019626857143000", "16901962685714300"],
        ["117414669285714000", "11741466928571400"],
        ["26440635500000000", "2644063550000000"],
        ["13049376500000000", "1304937650000000"],
        ["26094500642857100", "2609450064285710"],
        ["13048357285714300", "1304835728571430"],
        ["13050195500000000", "1305019550000000"],
        ["13048357285714300", "1304835728571430"],
        ["1304984642857140", "130498464285714"],
        ["13048709857142800", "1304870985714280"],
        ["141955417500000000", "14195541750000000"],
        ["3000922071428570", "300092207142857"],
        ["52185529642857100", "5218552964285710"],
        ["13048357285714300", "1304835728571430"],
        ["2818366071428570", "281836607142857"],
        ["26097798857142800", "2609779885714280"],
        ["13048409000000000", "1304840900000000"],
        ["22183750214285700", "2218375021428570"],
        ["301922043857143000", "30192204385714300"],
        ["26101226285714300", "2610122628571430"],
        ["12656113714285700", "1265611371428570"],
        ["117422683428571000", "11742268342857100"],
        ["13048154285714300", "1304815428571430"],
        ["195747262928571000", "19574726292857100"],
        ["182674785714286", "18267478571429"],
        ["130468357142857000", "13046835714285700"],
        ["11742086500000000", "1174208650000000"],
        ["195713099071428000", "19571309907142800"],
        ["2609507928571430", "260950792857143"],
        ["13047991357142800", "1304799135714280"],
        ["6522099071428560", "652209907142856"],
        ["13047879000000000", "1304787900000000"],
        ["521842974785714000", "52184297478571400"],
        ["13049292428571400", "1304929242857140"],
        ["339268554000000000", "33926855400000000"],
        ["13597189214285700", "1359718921428570"],
        ["13048017285714300", "1304801728571430"],
        ["26094865214285700", "2609486521428570"],
        ["195708754857143000", "19570875485714300"],
        ["13047146857142800", "1304714685714280"],
        ["4436865714285710", "443686571428571"],
        ["3540610642857140", "354061064285714"],
        ["65249233357142800", "6524923335714280"],
        ["13041462642857100", "1304146264285710"],
        ["117425252928571000", "11742525292857100"],
        ["13047903642857100", "1304790364285710"],
        ["1304981714285710", "130498171428571"],
        ["26251544428571400", "2625154442857140"],
        ["521896071428571", "52189607142857"],
        ["13047879000000000", "1304787900000000"],
        ["1304987714285710", "130498771428571"],
        ["11743816857142800", "1174381685714280"],
        ["1983200642857140", "198320064285714"],
        ["28711056357142800", "2871105635714280"],
        ["8873838142857130", "887383814285713"],
        ["34447663357142800", "3444766335714280"],
        ["52194248642857100", "5219424864285710"],
        ["13049183714285700", "1304918371428570"],
        ["65234968499999900", "6523496849999990"],
        ["130474579500000000", "13047457950000000"],
        ["13047991357142800", "1304799135714280"],
        ["13047321357142800", "1304732135714280"],
        ["26096621785714300", "2609662178571430"],
        ["13050378000000000", "1305037800000000"],
        ["13048257857142800", "1304825785714280"],
        ["25964330642857100", "2596433064285710"],
        ["13047487285714300", "1304748728571430"],
        ["71765115999999900", "7176511599999990"],
        ["13048983500000000", "1304898350000000"],
        ["6523939499999990", "652393949999999"],
        ["14351975357142800", "1435197535714280"],
        ["13048257857142800", "1304825785714280"],
        ["13049877571428600", "1304987757142860"],
        ["130472967571428000", "13047296757142800"],
        ["117446979714286000", "11744697971428600"],
        ["52198657642857100", "5219865764285710"],
        ["169257776928571000", "16925777692857100"],
        ["13048983500000000", "1304898350000000"],
        ["417506573642857000", "41750657364285700"],
        ["26096570642857100", "2609657064285710"],
        ["130492924571428000", "13049292457142800"],
        ["13048871571428600", "1304887157142860"],
        ["13048562142857100", "1304856214285710"],
        ["652393928571428", "65239392857143"],
        ["13049877571428600", "1304987757142860"],
        ["13048257857142800", "1304825785714280"],
        ["39143637142857100", "3914363714285710"]
    ]"#;
    const JSON_RESULTS_STAKER_TOTALS: &str = r#"
    [
        ["130499930214286000", "13049993021428600", "117449937192857400"],
        ["13048257857142800", "1304825785714280", "11743432071428520"],
        ["13048983500000000", "1304898350000000", "11744085150000000"],
        ["169019626857143000", "16901962685714300", "152117664171428700"],
        ["117414669285714000", "11741466928571400", "105673202357142600"],
        ["26440635500000000", "2644063550000000", "23796571950000000"],
        ["13049376500000000", "1304937650000000", "11744438850000000"],
        ["26094500642857100", "2609450064285710", "23485050578571390"],
        ["13048357285714300", "1304835728571430", "11743521557142870"],
        ["13050195500000000", "1305019550000000", "11745175950000000"],
        ["13048357285714300", "1304835728571430", "11743521557142870"],
        ["1304984642857140", "130498464285714", "1174486178571426"],
        ["13048709857142800", "1304870985714280", "11743838871428520"],
        ["141955417500000000", "14195541750000000", "127759875750000000"],
        ["3000922071428570", "300092207142857", "2700829864285713"],
        ["52185529642857100", "5218552964285710", "46966976678571390"],
        ["13048357285714300", "1304835728571430", "11743521557142870"],
        ["2818366071428570", "281836607142857", "2536529464285713"],
        ["26097798857142800", "2609779885714280", "23488018971428520"],
        ["13048409000000000", "1304840900000000", "11743568100000000"],
        ["22183750214285700", "2218375021428570", "19965375192857130"],
        ["301922043857143000", "30192204385714300", "271729839471428700"],
        ["26101226285714300", "2610122628571430", "23491103657142870"],
        ["12656113714285700", "1265611371428570", "11390502342857130"],
        ["117422683428571000", "11742268342857100", "105680415085713900"],
        ["13048154285714300", "1304815428571430", "11743338857142870"],
        ["195747262928571000", "19574726292857100", "176172536635713900"],
        ["182674785714286", "18267478571429", "164407307142857"],
        ["130468357142857000", "13046835714285700", "117421521428571300"],
        ["11742086500000000", "1174208650000000", "10567877850000000"],
        ["195713099071428000", "19571309907142800", "176141789164285200"],
        ["2609507928571430", "260950792857143", "2348557135714287"],
        ["13047991357142800", "1304799135714280", "11743192221428520"],
        ["6522099071428560", "652209907142856", "5869889164285704"],
        ["13047879000000000", "1304787900000000", "11743091100000000"],
        ["521842974785714000", "52184297478571400", "469658677307142600"],
        ["13049292428571400", "1304929242857140", "11744363185714260"],
        ["339268554000000000", "33926855400000000", "305341698600000000"],
        ["13597189214285700", "1359718921428570", "12237470292857130"],
        ["13048017285714300", "1304801728571430", "11743215557142870"],
        ["26094865214285700", "2609486521428570", "23485378692857130"],
        ["195708754857143000", "19570875485714300", "176137879371428700"],
        ["13047146857142800", "1304714685714280", "11742432171428520"],
        ["4436865714285710", "443686571428571", "3993179142857139"],
        ["3540610642857140", "354061064285714", "3186549578571426"],
        ["65249233357142800", "6524923335714280", "58724310021428520"],
        ["13041462642857100", "1304146264285710", "11737316378571390"],
        ["117425252928571000", "11742525292857100", "105682727635713900"],
        ["13047903642857100", "1304790364285710", "11743113278571390"],
        ["1304981714285710", "130498171428571", "1174483542857139"],
        ["26251544428571400", "2625154442857140", "23626389985714260"],
        ["521896071428571", "52189607142857", "469706464285714"],
        ["13047879000000000", "1304787900000000", "11743091100000000"],
        ["1304987714285710", "130498771428571", "1174488942857139"],
        ["11743816857142800", "1174381685714280", "10569435171428520"],
        ["1983200642857140", "198320064285714", "1784880578571426"],
        ["28711056357142800", "2871105635714280", "25839950721428520"],
        ["8873838142857130", "887383814285713", "7986454328571417"],
        ["34447663357142800", "3444766335714280", "31002897021428520"],
        ["52194248642857100", "5219424864285710", "46974823778571390"],
        ["13049183714285700", "1304918371428570", "11744265342857130"],
        ["65234968499999900", "6523496849999990", "58711471649999910"],
        ["130474579500000000", "13047457950000000", "117427121550000000"],
        ["13047991357142800", "1304799135714280", "11743192221428520"],
        ["13047321357142800", "1304732135714280", "11742589221428520"],
        ["26096621785714300", "2609662178571430", "23486959607142870"],
        ["13050378000000000", "1305037800000000", "11745340200000000"],
        ["13048257857142800", "1304825785714280", "11743432071428520"],
        ["25964330642857100", "2596433064285710", "23367897578571390"],
        ["13047487285714300", "1304748728571430", "11742738557142870"],
        ["71765115999999900", "7176511599999990", "64588604399999910"],
        ["13048983500000000", "1304898350000000", "11744085150000000"],
        ["6523939499999990", "652393949999999", "5871545549999991"],
        ["14351975357142800", "1435197535714280", "12916777821428520"],
        ["13048257857142800", "1304825785714280", "11743432071428520"],
        ["13049877571428600", "1304987757142860", "11744889814285740"],
        ["130472967571428000", "13047296757142800", "117425670814285200"],
        ["117446979714286000", "11744697971428600", "105702281742857400"],
        ["52198657642857100", "5219865764285710", "46978791878571390"],
        ["169257776928571000", "16925777692857100", "152331999235713900"],
        ["13048983500000000", "1304898350000000", "11744085150000000"],
        ["417506573642857000", "41750657364285700", "375755916278571300"],
        ["26096570642857100", "2609657064285710", "23486913578571390"],
        ["130492924571428000", "13049292457142800", "117443632114285200"],
        ["13048871571428600", "1304887157142860", "11743984414285740"],
        ["13048562142857100", "1304856214285710", "11743705928571390"],
        ["652393928571428", "65239392857143", "587154535714285"],
        ["13049877571428600", "1304987757142860", "11744889814285740"],
        ["13048257857142800", "1304825785714280", "11743432071428520"],
        ["39143637142857100", "3914363714285710", "35229273428571390"]
    ]
        "#;
}
