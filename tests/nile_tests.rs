use bigdecimal::{BigDecimal};
use std::str::FromStr;
use sqlite_functions::*;

#[test]
fn test_nile_staker_token_rewards() {
    let jsonResults = r#"
    [
        ["0.000000240375027", "71428571428571350000000", "17169644785714300"],
        ["0.000000182660779", "71428571428571350000000", "13047198500000000"],
        ["0.000000182637329", "71428571428571350000000", "13045523500000000"],
        ["0.000003470116004", "71428571428571350000000", "247865428857143000"],
        ["0.000021918909001", "71428571428571350000000", "1565636357214280000"],
        ["0.000003653540054", "71428571428571350000000", "260967146714285000"],
        ["0.000000913478881", "71428571428571350000000", "65248491499999900"],
        ["0.000000013027298", "71428571428571350000000", "930521285714285"],
        ["0.000002554296328", "71428571428571350000000", "182449737714286000"],
        ["0.000001826748407", "71428571428571350000000", "130482029071428000"],
        ["0.000001826999023", "71428571428571350000000", "130499930214286000"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000002366274776", "71428571428571350000000", "169019626857143000"],
        ["0.00000164380537", "71428571428571350000000", "117414669285714000"],
        ["0.000000370168897", "71428571428571350000000", "26440635500000000"],
        ["0.000000182691271", "71428571428571350000000", "13049376500000000"],
        ["0.000000365323009", "71428571428571350000000", "26094500642857100"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000182702737", "71428571428571350000000", "13050195500000000"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000018269785", "71428571428571350000000", "1304984642857140"],
        ["0.000000182681938", "71428571428571350000000", "13048709857142800"],
        ["0.000001987375845", "71428571428571350000000", "141955417500000000"],
        ["0.000000042012909", "71428571428571350000000", "3000922071428570"],
        ["0.000000730597415", "71428571428571350000000", "52185529642857100"],
        ["0.000000182677002", "71428571428571350000000", "13048357285714300"],
        ["0.000000039457125", "71428571428571350000000", "2818366071428570"],
        ["0.000000365369184", "71428571428571350000000", "26097798857142800"],
        ["0.000000182677726", "71428571428571350000000", "13048409000000000"],
        ["0.000000310572503", "71428571428571350000000", "22183750214285700"],
        ["0.000004226908614", "71428571428571350000000", "301922043857143000"],
        ["0.000000365417168", "71428571428571350000000", "26101226285714300"],
        ["0.000000177185592", "71428571428571350000000", "12656113714285700"],
        ["0.000001643917568", "71428571428571350000000", "117422683428571000"],
        ["0.00000018267416", "71428571428571350000000", "13048154285714300"],
        ["0.000002740461681", "71428571428571350000000", "195747262928571000"],
        ["0.000000002557447", "71428571428571350000000", "182674785714286"],
        ["0.000001826557", "71428571428571350000000", "130468357142857000"],
        ["0.000000164389211", "71428571428571350000000", "11742086500000000"],
        ["0.000002739983387", "71428571428571350000000", "195713099071428000"],
        ["0.000000036533111", "71428571428571350000000", "2609507928571430"],
        ["0.000000182671879", "71428571428571350000000", "13047991357142800"],
        ["0.000000091309387", "71428571428571350000000", "6522099071428560"],
        ["0.000000182670306", "71428571428571350000000", "13047879000000000"],
        ["0.000007305801647", "71428571428571350000000", "521842974785714000"],
        ["0.000000182690094", "71428571428571350000000", "13049292428571400"],
        ["0.000004749759756", "71428571428571350000000", "339268554000000000"],
        ["0.000000190360649", "71428571428571350000000", "13597189214285700"],
        ["0.000000182672242", "71428571428571350000000", "13048017285714300"],
        ["0.000000365328113", "71428571428571350000000", "26094865214285700"],
        ["0.000002739922568", "71428571428571350000000", "195708754857143000"],
        ["0.000000182660056", "71428571428571350000000", "13047146857142800"],
        ["0.00000006211612", "71428571428571350000000", "4436865714285710"],
        ["0.000000049568549", "71428571428571350000000", "3540610642857140"],
        ["0.000000913489267", "71428571428571350000000", "65249233357142800"],
        ["0.000000182580477", "71428571428571350000000", "13041462642857100"],
        ["0.000001643953541", "71428571428571350000000", "117425252928571000"],
        ["0.000000182670651", "71428571428571350000000", "13047903642857100"],
        ["0.000000018269744", "71428571428571350000000", "1304981714285710"],
        ["0.000000367521622", "71428571428571350000000", "26251544428571400"],
        ["0.000000007306545", "71428571428571350000000", "521896071428571"],
        ["0.000000182670306", "71428571428571350000000", "13047879000000000"],
        ["0.000000018269828", "71428571428571350000000", "1304987714285710"],
        ["0.000000164413436", "71428571428571350000000", "11743816857142800"],
        ["0.000000027764809", "71428571428571350000000", "1983200642857140"],
        ["0.000000401954789", "71428571428571350000000", "28711056357142800"],
        ["0.000000124233734", "71428571428571350000000", "8873838142857130"],
        ["0.000000482267287", "71428571428571350000000", "34447663357142800"],
        ["0.000000730719481", "71428571428571350000000", "52194248642857100"],
        ["0.000000182688572", "71428571428571350000000", "13049183714285700"],
        ["0.000000913289559", "71428571428571350000000", "65234968499999900"],
        ["0.000001826644113", "71428571428571350000000", "130474579500000000"],
        ["0.000000182671879", "71428571428571350000000", "13047991357142800"],
        ["0.000000182662499", "71428571428571350000000", "13047321357142800"],
        ["0.000000365352705", "71428571428571350000000", "26096621785714300"],
        ["0.000000182705292", "71428571428571350000000", "13050378000000000"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000363500629", "71428571428571350000000", "25964330642857100"],
        ["0.000000182664822", "71428571428571350000000", "13047487285714300"],
        ["0.000001004711624", "71428571428571350000000", "71765115999999900"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000000091335153", "71428571428571350000000", "6523939499999990"],
        ["0.000000200927655", "71428571428571350000000", "14351975357142800"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.000000182698286", "71428571428571350000000", "13049877571428600"],
        ["0.000001826621546", "71428571428571350000000", "130472967571428000"],
        ["0.000001644257716", "71428571428571350000000", "117446979714286000"],
        ["0.000000730781207", "71428571428571350000000", "52198657642857100"],
        ["0.000002369608877", "71428571428571350000000", "169257776928571000"],
        ["0.000000182685769", "71428571428571350000000", "13048983500000000"],
        ["0.000005845092031", "71428571428571350000000", "417506573642857000"],
        ["0.000000365351989", "71428571428571350000000", "26096570642857100"],
        ["0.000001826900944", "71428571428571350000000", "130492924571428000"],
        ["0.000000182684202", "71428571428571350000000", "13048871571428600"],
        ["0.00000018267987", "71428571428571350000000", "13048562142857100"],
        ["0.000000009133515", "71428571428571350000000", "652393928571428"],
        ["0.000000182698286", "71428571428571350000000", "13049877571428600"],
        ["0.00000018267561", "71428571428571350000000", "13048257857142800"],
        ["0.00000054801092", "71428571428571350000000", "39143637142857100"]
    ]"#;
    let results: Vec<Vec<String>> = serde_json::from_str(jsonResults).unwrap();

    let mut errors = 0;
    for result in results {
        let tokens = nile_calculations::nile_staker_token_rewards(&result[0], &result[1]);
        let expected = BigDecimal::from_str(&result[2]).unwrap();
        if tokens != expected {
            println!("Actual:   {}\nExpected: {}\n", tokens, expected);
            errors += 1;
        }
    }
    assert_eq!(errors, 0);
}
