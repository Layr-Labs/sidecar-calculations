use sqlite_functions::*;

#[cfg(test)]
mod amazon_tests {
    use super::*;

    #[test]
    fn test_amazon_staker_token_rewards() {
        let results = serde_json::from_str::<Vec<Vec<String>>>(JSON_RESULTS_STAKER_TOKENS).unwrap();
        let mut errors = 0;
        for result in results {
            let staker_proportion = &result[0];
            let tokens_per_day = &result[1];
            let tokens = amazon_calculations::amazon_staker_token_rewards(&staker_proportion, &tokens_per_day);
            let expected = &result[2];
            if expected == "" || tokens == "" || tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }
    #[test]
    fn test_amazon_operator_token_rewards() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_OPERATOR_TOKENS).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_tokens = amazon_calculations::amazon_operator_token_rewards(&result[0]);
            let expected = &result[1];
            if total_staker_operator_tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", total_staker_operator_tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    #[test]
    fn test_amazon_staker_total() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_STAKER_TOTAL).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_payout = &result[0];
            let operator_tokens = &result[1];
            let expected_result = &result[2];

            let staker_tokens = math::subtract_big(total_staker_operator_payout, operator_tokens);
            if staker_tokens != "" && staker_tokens != *expected_result {
                println!("Actual:   {}\nExpected: {}\n", staker_tokens, expected_result);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    const JSON_RESULTS_STAKER_TOKENS: &str = r#"
[
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"],
	["0.092173497467823", "142857142857142700000000", "13167642495403300000000"],
	["0.340626972698262", "142857142857142700000000", "48660996099751700000000"],
	["0.149069696024661", "142857142857142700000000", "21295670860665800000000"],
	["0.418129833809252", "142857142857142700000000", "59732833401321600000000"]
]
        "#;

    const JSON_RESULTS_OPERATOR_TOKENS: &str = r#"
[
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"],
	["13167642495403300000000", "1316764249540330000000"],
	["48660996099751700000000", "4866099609975170000000"],
	["21295670860665800000000", "2129567086066580000000"],
	["59732833401321600000000", "5973283340132160000000"]
]
        "#;

    const JSON_RESULTS_STAKER_TOTAL: &str = r#"
[
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"],
	["13167642495403300000000", "1316764249540330000000", "11850878245862970000000"],
	["48660996099751700000000", "4866099609975170000000", "43794896489776530000000"],
	["21295670860665800000000", "2129567086066580000000", "19166103774599220000000"],
	["59732833401321600000000", "5973283340132160000000", "53759550061189440000000"]
]
        "#;


}
