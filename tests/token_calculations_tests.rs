use sqlite_functions::*;

#[cfg(test)]
mod token_calculations_tests {
    use super::*;

    #[test]
    fn test_staker_token_rewards() {
        let results = serde_json::from_str::<Vec<Vec<String>>>(JSON_RESULTS_STAKER_TOKENS).unwrap();
        let mut errors = 0;
        for result in results {
            let staker_proportion = &result[0];
            let tokens_per_day = &result[1];
            let tokens = token_calculations::staker_token_rewards(&staker_proportion, &tokens_per_day);
            let expected = &result[2];
            if expected == "" || tokens == "" || tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    #[test]
    fn test_operator_token_rewards() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_OPERATOR_TOKENS).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_tokens = token_calculations::operator_token_rewards(&result[0]);
            let expected = &result[1];
            if total_staker_operator_tokens == "" || expected == "" || total_staker_operator_tokens != *expected {
                println!("Actual:   {}\nExpected: {}\n", total_staker_operator_tokens, expected);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    #[test]
    fn test_staker_total() {
        let results: Vec<Vec<String>> = serde_json::from_str(JSON_RESULTS_STAKER_TOTALS).unwrap();

        let mut errors = 0;
        for result in results {
            let total_staker_operator_payout = &result[0];
            let operator_tokens = &result[1];
            let expected_result = &result[2];

            let staker_tokens = math::subtract_big(total_staker_operator_payout, operator_tokens);
            if staker_tokens != "" && staker_tokens != *expected_result {
                println!("Actual:   {}\nExpected: {}\n", staker_tokens, expected_result);
                errors += 1;
            }
        }
        assert_eq!(errors, 0);
    }

    const JSON_RESULTS_STAKER_TOKENS: &str= r#"
[
	["0.00000327533587", "178571428571428571", "584881405357"],
	["0.000000141845238", "178571428571428571", "25329506785"],
	["0.000082782743848", "178571428571428571", "14782632829999"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001737682251", "178571428571428571", "310300401964"],
	["0.000003734712825", "178571428571428571", "666913004464"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000000141845238", "178571428571428571", "25329506785"],
	["0.000000141845238", "178571428571428571", "25329506785"],
	["0.000003797184132", "178571428571428571", "678068594999"],
	["0.000001967716253", "178571428571428571", "351377902321"],
	["0.000000141845238", "178571428571428571", "25329506785"],
	["0.000005869555747", "178571428571428571", "1048134954821"],
	["0.000087545166967", "178571428571428571", "15633065529821"],
	["0.000003127399087", "178571428571428571", "558464122678"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.00000257511391", "178571428571428571", "459841769642"],
	["0.000003146687911", "178571428571428571", "561908555535"],
	["0.000001815619057", "178571428571428571", "324217688749"],
	["0.000001698667661", "178571428571428571", "303333510892"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000000141845238", "178571428571428571", "25329506785"],
	["0.000001744696437", "178571428571428571", "311552935178"],
	["0.000000028369047", "178571428571428571", "5065901249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000004005520613", "178571428571428571", "715271538035"],
	["0.000002057288123", "178571428571428571", "367372879107"],
	["0.000001921085712", "178571428571428571", "343051019999"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000002190535979", "178571428571428571", "391167139107"],
	["0.00000249623368", "178571428571428571", "445756014285"],
	["0.000002723159231", "178571428571428571", "486278434107"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000004005751654", "178571428571428571", "715312795357"],
	["0.000002564599235", "178571428571428571", "457964149107"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000004645205202", "178571428571428571", "829500928928"],
	["0.000001609076855", "178571428571428571", "287335152678"],
	["0.000004004850346", "178571428571428571", "715151847499"],
	["0.000001819042992", "178571428571428571", "324829105714"],
	["0.000001898334381", "178571428571428571", "338988282321"],
	["0.000009083677345", "178571428571428571", "1622085240178"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000002137676139", "178571428571428571", "381727881964"],
	["0.000000896637483", "178571428571428571", "160113836249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000003404285731", "178571428571428571", "607908166249"],
	["0.000001589648367", "178571428571428571", "283865779821"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000047573796208", "178571428571428571", "8495320751428"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.00000169535044", "178571428571428571", "302741149999"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000003133523199", "178571428571428571", "559557714107"],
	["0.000003031791259", "178571428571428571", "541391296249"],
	["0.000002826231912", "178571428571428571", "504684269999"],
	["0.000004351664667", "178571428571428571", "777082976249"],
	["0.000002097623983", "178571428571428571", "374575711249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.00000267905624", "178571428571428571", "478402899999"],
	["0.000002032159275", "178571428571428571", "362885584821"],
	["0.000001418452388", "178571428571428571", "253295069285"],
	["0.000001571877069", "178571428571428571", "280692333749"],
	["0.000001772354832", "178571428571428571", "316491934285"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001627620005", "178571428571428571", "290646429464"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001954294228", "178571428571428571", "348981112142"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000059257402807", "178571428571428571", "10581679072678"],
	["0.000001712443026", "178571428571428571", "305793397499"],
	["0.000001986868624", "178571428571428571", "354797968571"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001621847466", "178571428571428571", "289615618928"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000003655514861", "178571428571428571", "652770510892"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000003625699748", "178571428571428571", "647446383571"],
	["0.000001418452388", "178571428571428571", "253295069285"],
	["0.000001692836614", "178571428571428571", "302292252499"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001828628233", "178571428571428571", "326540755892"],
	["0.000001727076242", "178571428571428571", "308406471785"],
	["0.00000220284214", "178571428571428571", "393364667857"],
	["0.000001560297627", "178571428571428571", "278624576249"],
	["0.000001606835234", "178571428571428571", "286934863214"],
	["0.000001748772999", "178571428571428571", "312280892678"],
	["0.000002453818313", "178571428571428571", "438181841607"],
	["0.000001560297627", "178571428571428571", "278624576249"]
]
        "#;

    const JSON_RESULTS_OPERATOR_TOKENS: &str =  r#"
[
	["584881405357", "58488140535"],
	["25329506785", "2532950678"],
	["14782632829999", "1478263282999"],
	["278624576249", "27862457624"],
	["310300401964", "31030040196"],
	["666913004464", "66691300446"],
	["278624576249", "27862457624"],
	["25329506785", "2532950678"],
	["25329506785", "2532950678"],
	["678068594999", "67806859499"],
	["351377902321", "35137790232"],
	["25329506785", "2532950678"],
	["1048134954821", "104813495482"],
	["15633065529821", "1563306552982"],
	["558464122678", "55846412267"],
	["278624576249", "27862457624"],
	["459841769642", "45984176964"],
	["561908555535", "56190855553"],
	["324217688749", "32421768874"],
	["303333510892", "30333351089"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["25329506785", "2532950678"],
	["311552935178", "31155293517"],
	["5065901249", "506590124"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["715271538035", "71527153803"],
	["367372879107", "36737287910"],
	["343051019999", "34305101999"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["391167139107", "39116713910"],
	["445756014285", "44575601428"],
	["486278434107", "48627843410"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["715312795357", "71531279535"],
	["457964149107", "45796414910"],
	["278624576249", "27862457624"],
	["829500928928", "82950092892"],
	["287335152678", "28733515267"],
	["715151847499", "71515184749"],
	["324829105714", "32482910571"],
	["338988282321", "33898828232"],
	["1622085240178", "162208524017"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["381727881964", "38172788196"],
	["160113836249", "16011383624"],
	["278624576249", "27862457624"],
	["607908166249", "60790816624"],
	["283865779821", "28386577982"],
	["278624576249", "27862457624"],
	["8495320751428", "849532075142"],
	["278624576249", "27862457624"],
	["302741149999", "30274114999"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["559557714107", "55955771410"],
	["541391296249", "54139129624"],
	["504684269999", "50468426999"],
	["777082976249", "77708297624"],
	["374575711249", "37457571124"],
	["278624576249", "27862457624"],
	["478402899999", "47840289999"],
	["362885584821", "36288558482"],
	["253295069285", "25329506928"],
	["280692333749", "28069233374"],
	["316491934285", "31649193428"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["290646429464", "29064642946"],
	["278624576249", "27862457624"],
	["348981112142", "34898111214"],
	["278624576249", "27862457624"],
	["10581679072678", "1058167907267"],
	["305793397499", "30579339749"],
	["354797968571", "35479796857"],
	["278624576249", "27862457624"],
	["289615618928", "28961561892"],
	["278624576249", "27862457624"],
	["652770510892", "65277051089"],
	["278624576249", "27862457624"],
	["278624576249", "27862457624"],
	["647446383571", "64744638357"],
	["253295069285", "25329506928"],
	["302292252499", "30229225249"],
	["278624576249", "27862457624"],
	["326540755892", "32654075589"],
	["308406471785", "30840647178"],
	["393364667857", "39336466785"],
	["278624576249", "27862457624"],
	["286934863214", "28693486321"],
	["312280892678", "31228089267"],
	["438181841607", "43818184160"],
	["278624576249", "27862457624"]
]
        "#;

    const JSON_RESULTS_STAKER_TOTALS: &str = r#"
[
	["584881405357", "58488140535", "526393264822"],
	["25329506785", "2532950678", "22796556107"],
	["14782632829999", "1478263282999", "13304369547000"],
	["278624576249", "27862457624", "250762118625"],
	["310300401964", "31030040196", "279270361768"],
	["666913004464", "66691300446", "600221704018"],
	["278624576249", "27862457624", "250762118625"],
	["25329506785", "2532950678", "22796556107"],
	["25329506785", "2532950678", "22796556107"],
	["678068594999", "67806859499", "610261735500"],
	["351377902321", "35137790232", "316240112089"],
	["25329506785", "2532950678", "22796556107"],
	["1048134954821", "104813495482", "943321459339"],
	["15633065529821", "1563306552982", "14069758976839"],
	["558464122678", "55846412267", "502617710411"],
	["278624576249", "27862457624", "250762118625"],
	["459841769642", "45984176964", "413857592678"],
	["561908555535", "56190855553", "505717699982"],
	["324217688749", "32421768874", "291795919875"],
	["303333510892", "30333351089", "273000159803"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["25329506785", "2532950678", "22796556107"],
	["311552935178", "31155293517", "280397641661"],
	["5065901249", "506590124", "4559311125"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["715271538035", "71527153803", "643744384232"],
	["367372879107", "36737287910", "330635591197"],
	["343051019999", "34305101999", "308745918000"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["391167139107", "39116713910", "352050425197"],
	["445756014285", "44575601428", "401180412857"],
	["486278434107", "48627843410", "437650590697"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["715312795357", "71531279535", "643781515822"],
	["457964149107", "45796414910", "412167734197"],
	["278624576249", "27862457624", "250762118625"],
	["829500928928", "82950092892", "746550836036"],
	["287335152678", "28733515267", "258601637411"],
	["715151847499", "71515184749", "643636662750"],
	["324829105714", "32482910571", "292346195143"],
	["338988282321", "33898828232", "305089454089"],
	["1622085240178", "162208524017", "1459876716161"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["381727881964", "38172788196", "343555093768"],
	["160113836249", "16011383624", "144102452625"],
	["278624576249", "27862457624", "250762118625"],
	["607908166249", "60790816624", "547117349625"],
	["283865779821", "28386577982", "255479201839"],
	["278624576249", "27862457624", "250762118625"],
	["8495320751428", "849532075142", "7645788676286"],
	["278624576249", "27862457624", "250762118625"],
	["302741149999", "30274114999", "272467035000"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["559557714107", "55955771410", "503601942697"],
	["541391296249", "54139129624", "487252166625"],
	["504684269999", "50468426999", "454215843000"],
	["777082976249", "77708297624", "699374678625"],
	["374575711249", "37457571124", "337118140125"],
	["278624576249", "27862457624", "250762118625"],
	["478402899999", "47840289999", "430562610000"],
	["362885584821", "36288558482", "326597026339"],
	["253295069285", "25329506928", "227965562357"],
	["280692333749", "28069233374", "252623100375"],
	["316491934285", "31649193428", "284842740857"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["290646429464", "29064642946", "261581786518"],
	["278624576249", "27862457624", "250762118625"],
	["348981112142", "34898111214", "314083000928"],
	["278624576249", "27862457624", "250762118625"],
	["10581679072678", "1058167907267", "9523511165411"],
	["305793397499", "30579339749", "275214057750"],
	["354797968571", "35479796857", "319318171714"],
	["278624576249", "27862457624", "250762118625"],
	["289615618928", "28961561892", "260654057036"],
	["278624576249", "27862457624", "250762118625"],
	["652770510892", "65277051089", "587493459803"],
	["278624576249", "27862457624", "250762118625"],
	["278624576249", "27862457624", "250762118625"],
	["647446383571", "64744638357", "582701745214"],
	["253295069285", "25329506928", "227965562357"],
	["302292252499", "30229225249", "272063027250"],
	["278624576249", "27862457624", "250762118625"],
	["326540755892", "32654075589", "293886680303"],
	["308406471785", "30840647178", "277565824607"],
	["393364667857", "39336466785", "354028201072"],
	["278624576249", "27862457624", "250762118625"],
	["286934863214", "28693486321", "258241376893"],
	["312280892678", "31228089267", "281052803411"],
	["438181841607", "43818184160", "394363657447"],
	["278624576249", "27862457624", "250762118625"]
]
        "#;
}
